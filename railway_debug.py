#!/usr/bin/env python3
"""
Railway Deployment Debug Script
Checks if GitHub integration is working properly in Railway environment
"""

import os
import json
import requests
from datetime import datetime

def check_railway_deployment():
    """Check if Railway deployment has real GitHub integration"""
    
    print("üöÄ Railway Deployment Debug")
    print("=" * 50)
    
    # Test API endpoints
    base_url = "https://web-production-3ef05.up.railway.app"
    
    endpoints = [
        "/api/evolution/heartbeat",
        "/api/evolution/competitive-analysis"
    ]
    
    for endpoint in endpoints:
        try:
            print(f"\nüîç Testing {endpoint}...")
            response = requests.get(f"{base_url}{endpoint}", timeout=10)
            
            if response.status_code == 200:
                data = response.json()
                print(f"‚úÖ Status: {response.status_code}")
                
                if endpoint == "/api/evolution/heartbeat":
                    connection_status = data.get('connection_status', 'unknown')
                    total_commits = data.get('total_commits', 0)
                    total_files = data.get('total_files', 0)
                    
                    print(f"üìä Connection Status: {connection_status}")
                    print(f"üìà Total Commits: {total_commits}")
                    print(f"üìÅ Total Files: {total_files}")
                    
                    if connection_status == 'connected' and total_commits > 150:
                        print("‚úÖ REAL GITHUB DATA DETECTED!")
                    else:
                        print("‚ö†Ô∏è FALLBACK/SIMULATED DATA DETECTED")
                        print("üí° Railway needs GITHUB_TOKEN environment variable")
                
                elif endpoint == "/api/evolution/competitive-analysis":
                    capabilities = data.get('frontier_ai_capabilities', {})
                    automation = capabilities.get('automation_level', 0)
                    innovation = capabilities.get('innovation_score', 0)
                    readiness = capabilities.get('market_readiness', 0)
                    
                    print(f"ü§ñ Automation Level: {automation}%")
                    print(f"üí° Innovation Score: {innovation}%")
                    print(f"üéØ Market Readiness: {readiness}%")
                    
                    if automation > 50 and innovation > 50:
                        print("‚úÖ COMPETITIVE ANALYSIS WORKING")
                    else:
                        print("‚ö†Ô∏è COMPETITIVE ANALYSIS USING FALLBACK DATA")
            else:
                print(f"‚ùå Status: {response.status_code}")
                print(f"Error: {response.text}")
                
        except Exception as e:
            print(f"‚ùå Error testing {endpoint}: {e}")
    
    print("\n" + "=" * 50)
    print("üìã RAILWAY SETUP CHECKLIST:")
    print("1. ‚úÖ Code deployed to Railway")
    print("2. ‚ùì GITHUB_TOKEN environment variable set?")
    print("3. ‚ùì Dependencies installed (requests, python-dotenv)?")
    print("4. ‚ùì GitHub API rate limits not exceeded?")
    print("\nüí° TO FIX: Set GITHUB_TOKEN in Railway Dashboard Variables")

if __name__ == "__main__":
    check_railway_deployment()
