<!DOCTYPE html>
<html>
<head>
    <title>Force Logout & Clear All Auth Data</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 8px; max-width: 600px; margin: 0 auto; }
        button { padding: 10px 20px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #b91c1c; }
        .status { margin: 20px 0; padding: 15px; background: #f3f4f6; border-radius: 4px; }
        .success { background: #d1fae5; color: #065f46; }
        .error { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Emergency Authentication Reset</h1>
        <p>This will completely clear all authentication data and force a fresh login.</p>
        
        <button onclick="forceLogout()">Clear All Auth Data & Reset</button>
        
        <div id="status" class="status" style="display: none;"></div>
        
        <div style="margin-top: 30px;">
            <h3>What this does:</h3>
            <ul>
                <li>Clears all localStorage data</li>
                <li>Clears all sessionStorage data</li>
                <li>Calls logout API to clear cookies</li>
                <li>Forces browser to forget all auth tokens</li>
                <li>Redirects to fresh login</li>
            </ul>
        </div>
    </div>

    <script>
        async function forceLogout() {
            const statusDiv = document.getElementById('status');
            statusDiv.style.display = 'block';
            statusDiv.className = 'status';
            statusDiv.textContent = 'Clearing authentication data...';
            
            try {
                // Clear all client-side storage
                console.log('Clearing localStorage...');
                localStorage.clear();
                
                console.log('Clearing sessionStorage...');
                sessionStorage.clear();
                
                // Call logout API
                console.log('Calling logout API...');
                try {
                    await fetch('/api/auth/logout', {
                        method: 'POST',
                        credentials: 'include'
                    });
                } catch (e) {
                    console.log('Logout API call failed (expected):', e);
                }
                
                // Call force logout API
                console.log('Calling force logout API...');
                try {
                    await fetch('/api/debug/force-logout', {
                        method: 'POST',
                        credentials: 'include'
                    });
                } catch (e) {
                    console.log('Force logout API call failed (expected):', e);
                }
                
                statusDiv.className = 'status success';
                statusDiv.textContent = '‚úÖ Authentication data cleared! Redirecting to login...';
                
                // Wait 2 seconds then redirect
                setTimeout(() => {
                    window.location.href = '/login';
                }, 2000);
                
            } catch (error) {
                console.error('Force logout error:', error);
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå Error during logout: ' + error.message;
            }
        }
        
        // Auto-clear on page load for safety
        console.log('Auto-clearing on page load...');
        localStorage.clear();
        sessionStorage.clear();
    </script>
</body>
</html>