generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model DataList {
  id            String           @id @default(cuid())
  listId        String           @unique
  name          String
  campaignId    String?
  active        Boolean          @default(false)
  blendWeight   Int?
  totalContacts Int              @default(0)
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  contacts      Contact[]
  queueEntries  DialQueueEntry[]

  @@map("data_lists")
}

model Contact {
  id                String           @id @default(cuid())
  contactId         String           @unique
  listId            String
  firstName         String
  lastName          String
  fullName          String?
  title             String?
  phone             String
  mobile            String?
  workPhone         String?
  homePhone         String?
  email             String?
  company           String?
  jobTitle          String?
  department        String?
  industry          String?
  address           String?
  address2          String?
  address3          String?
  city              String?
  state             String?
  zipCode           String?
  country           String?
  website           String?
  linkedIn          String?
  notes             String?
  tags              String?
  leadSource        String?
  leadScore         Int              @default(0)
  deliveryDate      DateTime?
  ageRange          String?
  residentialStatus String?
  custom1           String?
  custom2           String?
  custom3           String?
  custom4           String?
  custom5           String?
  status            String           @default("new")
  attemptCount      Int              @default(0)
  maxAttempts       Int              @default(3)
  lastAgentId       String?
  lastOutcome       String?
  locked            Boolean          @default(false)
  lockedBy          String?
  lockedAt          DateTime?
  lastAttempt       DateTime?
  nextAttempt       DateTime?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  callKPIs          CallKPI[]
  callRecords       CallRecord[]
  list              DataList         @relation(fields: [listId], references: [listId], onDelete: Cascade)
  queueEntries      DialQueueEntry[]
  interactions      Interaction[]
  sales             Sale[]
  tasks             Task[]
  workItems         WorkItem[]

  @@map("contacts")
}

model DialQueueEntry {
  id              String    @id @default(cuid())
  queueId         String    @unique
  campaignId      String
  listId          String
  contactId       String
  status          String    @default("queued")
  assignedAgentId String?
  priority        Int       @default(100)
  queuedAt        DateTime  @default(now())
  dialedAt        DateTime?
  completedAt     DateTime?
  outcome         String?
  notes           String?
  list            DataList  @relation(fields: [listId], references: [listId], onDelete: Cascade)
  contact         Contact   @relation(fields: [contactId], references: [contactId], onDelete: Cascade)

  @@map("dial_queue")
}

model Campaign {
  id                   String                    @id @default(cuid())
  campaignId           String                    @unique
  name                 String
  dialMethod           String                    @default("Progressive")
  speed                Float                     @default(2.0)
  dropPercentage       Float                     @default(0.0)
  status               String                    @default("Inactive")
  description          String?
  maxLines             Int?
  dialRatio            Float?
  recordCalls          Boolean                   @default(false)
  allowTransfers       Boolean                   @default(false)
  campaignScript       String?
  fieldMapping         String?
  retrySettings        String?
  hoursOfOperation     String?
  abandonRateThreshold Float?                    @default(0.05)
  pacingMultiplier     Float?                    @default(1.0)
  maxCallsPerAgent     Int?                      @default(1)
  createdAt            DateTime                  @default(now())
  updatedAt            DateTime                  @updatedAt
  createdById          Int?
  agentAssignments     AgentCampaignAssignment[]
  callKPIs             CallKPI[]
  callRecords          CallRecord[]
  campaignDispositions CampaignDisposition[]
  createdBy            User?                     @relation("CampaignCreator", fields: [createdById], references: [id])
  interactions         Interaction[]
  tasks                Task[]
  workItems            WorkItem[]
  userAssignments      UserCampaignAssignment[]  @relation("CampaignUserAssignments")

  @@map("campaigns")
}

model Agent {
  id                  String                    @id @default(cuid())
  agentId             String                    @unique
  firstName           String
  lastName            String
  email               String                    @unique
  status              String                    @default("Offline")
  lastStatusChange    DateTime                  @default(now())
  extension           String?
  skills              String?
  isLoggedIn          Boolean                   @default(false)
  currentCall         String?
  sipUsername         String?
  sipPassword         String?
  maxConcurrentCalls  Int                       @default(1)
  createdAt           DateTime                  @default(now())
  updatedAt           DateTime                  @updatedAt
  campaignAssignments AgentCampaignAssignment[]
  callKPIs            CallKPI[]
  callRecords         CallRecord[]
  interactions        Interaction[]
  sales               Sale[]
  tasks               Task[]
  workItems           WorkItem[]

  @@map("agents")
}

model AgentCampaignAssignment {
  id         String   @id @default(cuid())
  agentId    String
  campaignId String
  isActive   Boolean  @default(true)
  assignedAt DateTime @default(now())
  agent      Agent    @relation(fields: [agentId], references: [agentId], onDelete: Cascade)
  campaign   Campaign @relation(fields: [campaignId], references: [campaignId], onDelete: Cascade)

  @@unique([agentId, campaignId])
  @@map("agent_campaign_assignments")
}

model WorkItem {
  id          String    @id @default(cuid())
  workItemId  String    @unique
  agentId     String
  campaignId  String
  contactId   String
  callId      String?
  status      String    @default("active")
  contactData String?
  scriptData  String?
  startTime   DateTime  @default(now())
  endTime     DateTime?
  agent       Agent     @relation(fields: [agentId], references: [agentId], onDelete: Cascade)
  campaign    Campaign  @relation(fields: [campaignId], references: [campaignId], onDelete: Cascade)
  contact     Contact   @relation(fields: [contactId], references: [contactId], onDelete: Cascade)

  @@map("work_items")
}

model Disposition {
  id                   String                @id @default(cuid())
  name                 String
  description          String?
  category             String?
  isActive             Boolean               @default(true)
  retryEligible        Boolean               @default(false)
  retryDelay           Int?
  createdAt            DateTime              @default(now())
  callRecords          CallRecord[]
  campaignDispositions CampaignDisposition[]

  @@map("dispositions")
}

model CampaignDisposition {
  id            String      @id @default(cuid())
  campaignId    String
  dispositionId String
  isRequired    Boolean     @default(false)
  sortOrder     Int         @default(0)
  campaign      Campaign    @relation(fields: [campaignId], references: [campaignId], onDelete: Cascade)
  disposition   Disposition @relation(fields: [dispositionId], references: [id], onDelete: Cascade)

  @@unique([campaignId, dispositionId])
  @@map("campaign_dispositions")
}

model CallKPI {
  id                  String   @id @default(cuid())
  campaignId          String
  agentId             String
  contactId           String
  callId              String   @unique
  disposition         String
  dispositionCategory String
  callDuration        Int
  callDate            DateTime
  hourOfDay           Int
  dayOfWeek           Int
  listId              String?
  outcome             String
  notes               String?
  createdAt           DateTime @default(now())
  contact             Contact  @relation(fields: [contactId], references: [contactId], onDelete: Cascade)
  campaign            Campaign @relation(fields: [campaignId], references: [campaignId], onDelete: Cascade)
  agent               Agent    @relation(fields: [agentId], references: [agentId], onDelete: Cascade)

  @@map("call_kpis")
}

model CallRecord {
  id            String       @id @default(cuid())
  callId        String       @unique
  campaignId    String
  contactId     String
  agentId       String?
  phoneNumber   String
  dialedNumber  String?
  callType      String       @default("outbound")
  startTime     DateTime
  endTime       DateTime?
  duration      Int?
  outcome       String?
  dispositionId String?
  notes         String?
  recording     String?
  transferTo    String?
  createdAt     DateTime     @default(now())
  campaign      Campaign     @relation(fields: [campaignId], references: [campaignId], onDelete: Cascade)
  contact       Contact      @relation(fields: [contactId], references: [contactId], onDelete: Cascade)
  agent         Agent?       @relation(fields: [agentId], references: [agentId])
  disposition   Disposition? @relation(fields: [dispositionId], references: [id])
  recordingFile Recording?

  @@map("call_records")
}

model Interaction {
  id              String    @id @default(cuid())
  agentId         String
  contactId       String
  campaignId      String
  channel         String    @default("voice")
  outcome         String
  isDmc           Boolean   @default(false)
  startedAt       DateTime
  endedAt         DateTime?
  durationSeconds Int?
  result          String?
  agent           Agent     @relation(fields: [agentId], references: [agentId], onDelete: Cascade)
  contact         Contact   @relation(fields: [contactId], references: [contactId], onDelete: Cascade)
  campaign        Campaign  @relation(fields: [campaignId], references: [campaignId], onDelete: Cascade)
  sales           Sale[]

  @@map("interactions")
}

model Sale {
  id            String      @id @default(cuid())
  interactionId String
  contactId     String
  agentId       String
  amount        Float
  status        String      @default("success")
  createdAt     DateTime    @default(now())
  interaction   Interaction @relation(fields: [interactionId], references: [id], onDelete: Cascade)
  contact       Contact     @relation(fields: [contactId], references: [contactId], onDelete: Cascade)
  agent         Agent       @relation(fields: [agentId], references: [agentId], onDelete: Cascade)

  @@map("sales")
}

model Task {
  id             String   @id @default(cuid())
  assignedUserId String
  contactId      String
  campaignId     String
  type           String   @default("callback")
  notes          String?
  dueAt          DateTime
  status         String   @default("open")
  createdAt      DateTime @default(now())
  assignedUser   Agent    @relation(fields: [assignedUserId], references: [agentId], onDelete: Cascade)
  contact        Contact  @relation(fields: [contactId], references: [contactId], onDelete: Cascade)
  campaign       Campaign @relation(fields: [campaignId], references: [campaignId], onDelete: Cascade)

  @@map("tasks")
}

model User {
  id                    Int                    @id @default(autoincrement())
  username              String                 @unique
  email                 String                 @unique
  password              String
  firstName             String
  lastName              String
  name                  String
  role                  String                 @default("AGENT")
  isActive              Boolean                @default(true)
  lastLogin             DateTime?
  lastLoginAttempt      DateTime?
  failedLoginAttempts   Int                    @default(0)
  accountLockedUntil    DateTime?
  passwordResetToken    String?
  passwordResetExpires  DateTime?
  twoFactorSecret       String?
  twoFactorEnabled      Boolean                @default(false)
  refreshTokenVersion   Int                    @default(0)
  preferences           String?
  status                String                 @default("away")
  statusSince           DateTime               @default(now())
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  createdCampaigns      Campaign[]             @relation("CampaignCreator")
  channelActivities     ChannelActivity[]      @relation("ChannelActivityUser")
  channelAssignments    ChannelAssignment[]    @relation("ChannelUserAssignment")
  assignedChannels      ChannelAssignment[]    @relation("ChannelAssigner")
  channelConfigurations ChannelConfiguration[] @relation("ChannelConfigCreator")
  channelSchedules      ChannelSchedule[]      @relation("ChannelScheduleCreator")
  createdChannels       Channel[]              @relation("ChannelCreator")
  updatedChannels       Channel[]              @relation("ChannelUpdater")
  emailVerifications    EmailVerification[]
  flows                 Flow[]
  integrations          Integration[]          @relation("UserIntegrations")
  notifications         Notification[]         @relation("UserNotifications")
  refreshTokens         RefreshToken[]
  resolvedAlerts        SystemAlert[]          @relation("AlertResolver")
  acknowledgedAlerts    SystemAlert[]          @relation("AlertAcknowledger")
  webhooks              Webhook[]              @relation("UserWebhooks")
  campaignAssignments   UserCampaignAssignment[] @relation("UserCampaignAssignments")
  assignedCampaigns     UserCampaignAssignment[] @relation("CampaignAssigner")

  @@map("users")
}

model UserCampaignAssignment {
  id         String   @id @default(cuid())
  userId     Int
  campaignId String
  isActive   Boolean  @default(true)
  assignedAt DateTime @default(now())
  assignedBy Int? // Admin who assigned this campaign
  user       User     @relation("UserCampaignAssignments", fields: [userId], references: [id], onDelete: Cascade)
  campaign   Campaign @relation("CampaignUserAssignments", fields: [campaignId], references: [campaignId], onDelete: Cascade)
  assignedByUser User? @relation("CampaignAssigner", fields: [assignedBy], references: [id])

  @@unique([userId, campaignId])
  @@map("user_campaign_assignments")
}

model RefreshToken {
  id        String    @id @default(cuid())
  token     String    @unique
  userId    Int
  expiresAt DateTime
  createdAt DateTime  @default(now())
  lastUsed  DateTime?
  isRevoked Boolean   @default(false)
  userAgent String?
  ipAddress String?
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("refresh_tokens")
}

model Flow {
  id              String        @id @default(cuid())
  name            String
  description     String
  status          String        @default("INACTIVE")
  createdByUserId Int
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  versions        FlowVersion[]
  createdBy       User          @relation(fields: [createdByUserId], references: [id])

  @@map("flows")
}

model FlowVersion {
  id            String     @id @default(cuid())
  flowId        String
  versionNumber Int
  isActive      Boolean    @default(false)
  isDraft       Boolean    @default(true)
  createdAt     DateTime   @default(now())
  publishedAt   DateTime?
  edges         FlowEdge[]
  nodes         FlowNode[]
  runs          FlowRun[]
  flow          Flow       @relation(fields: [flowId], references: [id], onDelete: Cascade)

  @@unique([flowId, versionNumber])
  @@map("flow_versions")
}

model FlowNode {
  id            String      @id @default(cuid())
  flowVersionId String
  type          String
  label         String
  category      String
  x             Float
  y             Float
  config        String
  isEntry       Boolean     @default(false)
  sourceEdges   FlowEdge[]  @relation("SourceNode")
  targetEdges   FlowEdge[]  @relation("TargetNode")
  flowVersion   FlowVersion @relation(fields: [flowVersionId], references: [id], onDelete: Cascade)

  @@map("flow_nodes")
}

model FlowEdge {
  id            String      @id @default(cuid())
  flowVersionId String
  sourceNodeId  String
  targetNodeId  String
  sourcePort    String
  label         String?
  flowVersion   FlowVersion @relation(fields: [flowVersionId], references: [id], onDelete: Cascade)
  sourceNode    FlowNode    @relation("SourceNode", fields: [sourceNodeId], references: [id], onDelete: Cascade)
  targetNode    FlowNode    @relation("TargetNode", fields: [targetNodeId], references: [id], onDelete: Cascade)

  @@map("flow_edges")
}

model NodeTypeDefinition {
  id          String  @id @default(cuid())
  type        String  @unique
  category    String
  displayName String
  icon        String?
  schema      String
  ports       String

  @@map("node_type_definitions")
}

model FlowRun {
  id                String        @id @default(cuid())
  flowVersionId     String
  externalReference String?
  status            String        @default("RUNNING")
  startedAt         DateTime      @default(now())
  finishedAt        DateTime?
  context           String
  steps             FlowRunStep[]
  flowVersion       FlowVersion   @relation(fields: [flowVersionId], references: [id])

  @@map("flow_runs")
}

model FlowRunStep {
  id         String    @id @default(cuid())
  flowRunId  String
  nodeId     String
  status     String    @default("PENDING")
  startedAt  DateTime  @default(now())
  finishedAt DateTime?
  output     String?
  flowRun    FlowRun   @relation(fields: [flowRunId], references: [id], onDelete: Cascade)

  @@map("flow_run_steps")
}

model Organization {
  id          String    @id @default(cuid())
  name        String    @unique
  displayName String
  description String?
  website     String?
  industry    String?
  size        String?
  timezone    String    @default("UTC")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  channels    Channel[]

  @@map("organizations")
}

model Team {
  id                 String              @id @default(cuid())
  name               String              @unique
  displayName        String
  description        String?
  department         String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  channelAssignments ChannelAssignment[] @relation("ChannelTeamAssignment")

  @@map("teams")
}

model Role {
  id                 String              @id @default(cuid())
  name               String              @unique
  displayName        String
  description        String?
  permissions        String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  channelAssignments ChannelAssignment[] @relation("ChannelRoleAssignment")

  @@map("roles")
}

model Channel {
  id                 String                 @id @default(cuid())
  name               String                 @unique
  displayName        String
  description        String?
  type               String
  status             String                 @default("ACTIVE")
  priority           Int                    @default(1)
  isInbound          Boolean                @default(true)
  isOutbound         Boolean                @default(true)
  isBlended          Boolean                @default(false)
  maxConcurrentCalls Int                    @default(100)
  maxQueueSize       Int                    @default(1000)
  maxWaitTime        Int                    @default(300)
  predictiveMode     Boolean                @default(false)
  progressiveMode    Boolean                @default(true)
  previewMode        Boolean                @default(false)
  manualMode         Boolean                @default(false)
  dialingRatio       Float                  @default(1.0)
  abandonThreshold   Float                  @default(0.05)
  pacingMultiplier   Float                  @default(1.0)
  timezone           String                 @default("UTC")
  dialingStart       String?
  dialingEnd         String?
  dncCompliance      Boolean                @default(true)
  tcpaCompliance     Boolean                @default(true)
  gdprCompliance     Boolean                @default(true)
  callRecording      Boolean                @default(true)
  qualityMonitoring  Boolean                @default(true)
  screenRecording    Boolean                @default(false)
  slaAnswerTime      Int?
  slaResolutionTime  Int?
  slaEscalationTime  Int?
  tags               String?
  customFields       String?
  createdAt          DateTime               @default(now())
  updatedAt          DateTime               @updatedAt
  createdBy          Int?
  updatedBy          Int?
  organizationId     String
  activities         ChannelActivity[]
  assignments        ChannelAssignment[]
  capacities         ChannelCapacity[]
  configurations     ChannelConfiguration[]
  metrics            ChannelMetrics[]
  routes             ChannelRoute[]
  schedules          ChannelSchedule[]
  organization       Organization           @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  creator            User?                  @relation("ChannelCreator", fields: [createdBy], references: [id])
  updater            User?                  @relation("ChannelUpdater", fields: [updatedBy], references: [id])

  @@index([organizationId])
  @@index([type])
  @@index([status])
  @@index([priority])
  @@index([createdAt])
  @@map("channels")
}

model ChannelRoute {
  id              String   @id @default(cuid())
  name            String
  displayName     String
  description     String?
  routeType       String
  priority        Int      @default(1)
  isActive        Boolean  @default(true)
  conditions      String
  actions         String
  fallbackRoute   String?
  loadBalancing   String   @default("ROUND_ROBIN")
  weightingFactor Float    @default(1.0)
  maxConcurrent   Int      @default(10)
  timeoutSeconds  Int      @default(30)
  retryAttempts   Int      @default(3)
  businessHours   String?
  holidaySchedule String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  channelId       String
  channel         Channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)

  @@index([channelId])
  @@index([routeType])
  @@index([priority])
  @@index([isActive])
  @@map("channel_routes")
}

model ChannelConfiguration {
  id          String   @id @default(cuid())
  configType  String
  name        String
  description String?
  settings    String
  parameters  String?
  validation  String?
  version     String   @default("1.0.0")
  isActive    Boolean  @default(true)
  isDefault   Boolean  @default(false)
  environment String   @default("PRODUCTION")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   Int?
  channelId   String
  channel     Channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)
  creator     User?    @relation("ChannelConfigCreator", fields: [createdBy], references: [id])

  @@unique([channelId, configType, name])
  @@index([channelId])
  @@index([configType])
  @@index([environment])
  @@map("channel_configurations")
}

model ChannelSchedule {
  id            String    @id @default(cuid())
  name          String
  description   String?
  scheduleType  String
  timezone      String    @default("UTC")
  startTime     String
  endTime       String
  daysOfWeek    String
  dates         String?
  exceptions    String?
  maxConcurrent Int?
  maxQueue      Int?
  dialingRatio  Float?
  isActive      Boolean   @default(true)
  priority      Int       @default(1)
  effectiveFrom DateTime  @default(now())
  effectiveTo   DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  createdBy     Int?
  channelId     String
  channel       Channel   @relation(fields: [channelId], references: [id], onDelete: Cascade)
  creator       User?     @relation("ChannelScheduleCreator", fields: [createdBy], references: [id])

  @@index([channelId])
  @@index([scheduleType])
  @@index([effectiveFrom])
  @@index([effectiveTo])
  @@map("channel_schedules")
}

model ChannelCapacity {
  id                   String   @id @default(cuid())
  capacityType         String
  maxConcurrent        Int
  currentUtilization   Int      @default(0)
  peakUtilization      Int      @default(0)
  averageUtilization   Float    @default(0)
  successfulCalls      Int      @default(0)
  failedCalls          Int      @default(0)
  droppedCalls         Int      @default(0)
  abandonedCalls       Int      @default(0)
  averageWaitTime      Float    @default(0)
  averageHandleTime    Float    @default(0)
  averageHoldTime      Float    @default(0)
  firstCallResolution  Float    @default(0)
  customerSatisfaction Float    @default(0)
  agentUtilization     Float    @default(0)
  periodStart          DateTime
  periodEnd            DateTime
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  channelId            String
  channel              Channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)

  @@index([channelId])
  @@index([capacityType])
  @@index([periodStart])
  @@index([periodEnd])
  @@map("channel_capacities")
}

model ChannelAssignment {
  id                   String   @id @default(cuid())
  assignmentType       String
  priority             Int      @default(1)
  isActive             Boolean  @default(true)
  maxConcurrent        Int?
  skillRequirement     String?
  scheduleOverride     String?
  availabilityWindow   String?
  minimumExperience    Int?
  performanceThreshold Float?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  assignedAt           DateTime @default(now())
  assignedBy           Int?
  channelId            String
  userId               Int?
  teamId               String?
  roleId               String?
  channel              Channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)
  user                 User?    @relation("ChannelUserAssignment", fields: [userId], references: [id], onDelete: Cascade)
  team                 Team?    @relation("ChannelTeamAssignment", fields: [teamId], references: [id], onDelete: Cascade)
  role                 Role?    @relation("ChannelRoleAssignment", fields: [roleId], references: [id], onDelete: Cascade)
  assigner             User?    @relation("ChannelAssigner", fields: [assignedBy], references: [id])

  @@index([channelId])
  @@index([assignmentType])
  @@index([userId])
  @@index([teamId])
  @@index([roleId])
  @@index([assignedAt])
  @@map("channel_assignments")
}

model ChannelMetrics {
  id                   String   @id @default(cuid())
  metricType           String
  totalCalls           Int      @default(0)
  successfulCalls      Int      @default(0)
  failedCalls          Int      @default(0)
  droppedCalls         Int      @default(0)
  abandonedCalls       Int      @default(0)
  inboundCalls         Int      @default(0)
  outboundCalls        Int      @default(0)
  peakConcurrent       Int      @default(0)
  averageConcurrent    Float    @default(0)
  totalCallDuration    Int      @default(0)
  averageCallDuration  Float    @default(0)
  totalWaitTime        Int      @default(0)
  averageWaitTime      Float    @default(0)
  totalHandleTime      Int      @default(0)
  averageHandleTime    Float    @default(0)
  serviceLevel         Float    @default(0)
  abandonRate          Float    @default(0)
  firstCallResolution  Float    @default(0)
  transferRate         Float    @default(0)
  agentUtilization     Float    @default(0)
  channelUtilization   Float    @default(0)
  costPerCall          Float    @default(0)
  revenuePerCall       Float    @default(0)
  customerSatisfaction Float    @default(0)
  netPromoterScore     Float    @default(0)
  complaintsReceived   Int      @default(0)
  complimentsReceived  Int      @default(0)
  periodType           String
  periodStart          DateTime
  periodEnd            DateTime
  calculatedAt         DateTime @default(now())
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  channelId            String
  channel              Channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)

  @@index([channelId])
  @@index([metricType])
  @@index([periodType])
  @@index([periodStart])
  @@index([periodEnd])
  @@index([calculatedAt])
  @@map("channel_metrics")
}

model ChannelActivity {
  id            String   @id @default(cuid())
  activityType  String
  description   String
  details       String?
  oldValues     String?
  newValues     String?
  ipAddress     String?
  userAgent     String?
  sessionId     String?
  impactLevel   String   @default("LOW")
  affectedUsers Int      @default(0)
  timestamp     DateTime @default(now())
  channelId     String
  userId        Int?
  channel       Channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)
  user          User?    @relation("ChannelActivityUser", fields: [userId], references: [id])

  @@index([channelId])
  @@index([activityType])
  @@index([timestamp])
  @@index([userId])
  @@index([impactLevel])
  @@map("channel_activities")
}

model Integration {
  id            String           @id @default(cuid())
  name          String
  type          String
  description   String?
  provider      String
  isActive      Boolean          @default(true)
  configuration String
  credentials   String?
  lastSync      DateTime?
  syncStatus    String           @default("inactive")
  errorMessage  String?
  createdBy     Int
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  syncLogs      IntegrationLog[]
  creator       User             @relation("UserIntegrations", fields: [createdBy], references: [id])
  webhooks      Webhook[]

  @@map("integrations")
}

model IntegrationLog {
  id               String      @id @default(cuid())
  integrationId    String
  action           String
  status           String
  message          String
  details          String?
  recordsProcessed Int?
  errorCount       Int?
  duration         Int?
  timestamp        DateTime    @default(now())
  integration      Integration @relation(fields: [integrationId], references: [id], onDelete: Cascade)

  @@index([integrationId])
  @@index([timestamp])
  @@index([status])
  @@map("integration_logs")
}

model Webhook {
  id            String            @id @default(cuid())
  name          String
  url           String
  secret        String?
  events        String
  isActive      Boolean           @default(true)
  integrationId String?
  retryPolicy   String?
  headers       String?
  createdBy     Int
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  deliveries    WebhookDelivery[]
  integration   Integration?      @relation(fields: [integrationId], references: [id])
  creator       User              @relation("UserWebhooks", fields: [createdBy], references: [id])

  @@map("webhooks")
}

model WebhookDelivery {
  id           String    @id @default(cuid())
  webhookId    String
  eventType    String
  payload      String
  status       String
  responseCode Int?
  responseBody String?
  attemptCount Int       @default(0)
  maxAttempts  Int       @default(3)
  nextRetry    DateTime?
  deliveredAt  DateTime?
  createdAt    DateTime  @default(now())
  webhook      Webhook   @relation(fields: [webhookId], references: [id], onDelete: Cascade)

  @@index([webhookId])
  @@index([status])
  @@index([eventType])
  @@index([nextRetry])
  @@map("webhook_deliveries")
}

model Recording {
  id             String         @id @default(cuid())
  callRecordId   String         @unique
  fileName       String
  filePath       String
  fileSize       Int?
  duration       Int?
  format         String         @default("wav")
  quality        String         @default("standard")
  storageType    String         @default("local")
  isEncrypted    Boolean        @default(false)
  uploadStatus   String         @default("pending")
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  callRecord     CallRecord     @relation(fields: [callRecordId], references: [id], onDelete: Cascade)
  transcriptions Transcription?

  @@index([uploadStatus])
  @@map("recordings")
}

model Transcription {
  id             String    @id @default(cuid())
  recordingId    String    @unique
  provider       String
  language       String    @default("en")
  text           String
  segments       String?
  confidence     Float?
  wordCount      Int?
  processingTime Int?
  cost           Float?
  status         String    @default("pending")
  errorMessage   String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  recording      Recording @relation(fields: [recordingId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([language])
  @@map("transcriptions")
}

model Notification {
  id          String    @id @default(cuid())
  userId      Int
  title       String
  message     String
  type        String    @default("info")
  category    String?
  priority    String    @default("normal")
  isRead      Boolean   @default(false)
  actionUrl   String?
  actionLabel String?
  metadata    String?
  expiresAt   DateTime?
  createdAt   DateTime  @default(now())
  user        User      @relation("UserNotifications", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([type])
  @@index([priority])
  @@index([createdAt])
  @@map("notifications")
}

model SystemAlert {
  id             String    @id @default(cuid())
  title          String
  message        String
  alertType      String
  severity       String
  status         String    @default("active")
  source         String?
  metadata       String?
  acknowledgedBy Int?
  acknowledgedAt DateTime?
  resolvedBy     Int?
  resolvedAt     DateTime?
  createdAt      DateTime  @default(now())
  resolver       User?     @relation("AlertResolver", fields: [resolvedBy], references: [id])
  acknowledger   User?     @relation("AlertAcknowledger", fields: [acknowledgedBy], references: [id])

  @@index([alertType])
  @@index([severity])
  @@index([status])
  @@index([createdAt])
  @@map("system_alerts")
}

model AuditLog {
  id                   String   @id @default(cuid())
  action               String
  entityType           String
  entityId             String?
  performedByUserId    String
  performedByUserEmail String
  performedByUserName  String
  ipAddress            String?
  userAgent            String?
  sessionId            String?
  previousValues       String?
  newValues            String?
  metadata             String?
  severity             String   @default("INFO")
  timestamp            DateTime @default(now())

  @@index([action])
  @@index([entityType])
  @@index([performedByUserId])
  @@index([timestamp])
  @@index([severity])
  @@map("audit_logs")
}

model EmailVerification {
  id         String    @id @default(cuid())
  userId     Int
  email      String
  token      String    @unique
  tokenHash  String
  expiresAt  DateTime
  verifiedAt DateTime?
  ipAddress  String?
  userAgent  String?
  attempts   Int       @default(0)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([email])
  @@index([expiresAt])
  @@map("email_verifications")
}
